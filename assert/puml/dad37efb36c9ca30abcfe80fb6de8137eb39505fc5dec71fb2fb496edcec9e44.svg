<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1077px" preserveAspectRatio="none" style="width:1645px;height:1077px;background:#FFFFFF;" version="1.1" viewBox="0 0 1645 1077" width="1645px" zoomAndPan="magnify"><defs/><g><rect fill="#FFA500" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="182" x="10" y="519.546"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="162" x="20" y="542.5411">Kernel Logical Address</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="245" x="242" y="48.4"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="225" x="252" y="71.3951">Normal address space of kernel</text><rect fill="#FFE4B5" height="36.7999" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="92" x="537" y="20"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="72" x="547" y="42.9639">kmalloc()</text><path d="M487,66.5484 L497,66.5484 C512,66.5484 512,38.4 527,38.4 L537,38.4 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="216" x="537" y="76.7999"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="547" y="99.795">Kernel stacks (per process)</text><path d="M487,66.5484 L497,66.5484 C512,66.5484 512,94.9484 527,94.9484 L537,94.9484 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M192,537.6945 L202,537.6945 C217,537.6945 217,66.5484 232,66.5484 L242,66.5484 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="344" x="242" y="170.3937"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="10" x="252" y="193.3888">A</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="95" x="266" y="193.3888">fixed offset</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="211" x="365" y="193.3888">from their physical addresses</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="286" x="639" y="137.0919">Virt: 0xc0000000 --&gt; Phys: 0x00000000</text><path d="M586,188.5421 L596,188.5421 C611,188.5421 611,132.2452 626,132.2452 L636,132.2452 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="506" x="636" y="151.3937"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="486" x="646" y="174.3888">virtually-contiguous regions are by nature also physically contiguous</text><path d="M586,188.5421 L596,188.5421 C611,188.5421 611,169.5421 626,169.5421 L636,169.5421 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="646" x="636" y="207.6906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="517" x="646" y="230.6857">combined with the inablity to be swapped out, makes them suitable for</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="36" x="1167" y="230.6857">DMA</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="1207" y="230.6857">transfers</text><path d="M586,188.5421 L596,188.5421 C611,188.5421 611,225.839 626,225.839 L636,225.839 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M192,537.6945 L202,537.6945 C217,537.6945 217,188.5421 232,188.5421 L242,188.5421 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="341" x="242" y="292.6389"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="321" x="252" y="315.634">easy to convert between virtual and physical</text><rect fill="#FFE4B5" height="36.7999" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="633" y="263.9874"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="56" x="643" y="286.9514">__pa(x)</text><path d="M583,310.7874 L593,310.7874 C608,310.7874 608,282.3874 623,282.3874 L633,282.3874 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#FFE4B5" height="36.7999" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="76" x="633" y="320.7874"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="56" x="643" y="343.7513">__va(x)</text><path d="M583,310.7874 L593,310.7874 C608,310.7874 608,339.1873 623,339.1873 L633,339.1873 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M192,537.6945 L202,537.6945 C217,537.6945 217,310.7874 232,310.7874 L242,310.7874 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="211" x="242" y="348.9358"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="252" y="371.9309">Can never be swapped out</text><path d="M192,537.6945 L202,537.6945 C217,537.6945 217,367.0842 232,367.0842 L242,367.0842 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="82" x="242" y="712.1624"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="252" y="735.1575">Mapping</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="62" x="374" y="655.8655"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="384" y="678.8606">32 bit</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="338" x="486" y="405.2327"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="318" x="496" y="428.2278">for small-memory systems (below 1GB RAM)</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="759" x="874" y="405.2327"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="271" x="884" y="428.2278">Kernel Logical address space starts at</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="109" x="1159" y="428.2278">PAGE_OFFSET</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="1272" y="428.2278">and goes through the</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="193" x="1430" y="428.2278">end of physical memory</text><path d="M824,423.3811 L834,423.3811 C849,423.3811 849,423.3811 864,423.3811 L874,423.3811 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M436,674.0139 L446,674.0139 C461,674.0139 461,423.3811 476,423.3811 L486,423.3811 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="369" x="486" y="684.0139"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="349" x="496" y="707.009">for large-memory systems (more than 1GB RAM)</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="526" x="905" y="461.5295"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="506" x="915" y="484.5247">not all of the physical RAM can be mapped into kernel's address space</text><path d="M855,702.1624 L865,702.1624 C880,702.1624 880,479.678 895,479.678 L905,479.678 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="533" x="905" y="517.8264"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="513" x="915" y="540.8215">kernel address space is the top 1GB of virtual address space, by default</text><path d="M855,702.1624 L865,702.1624 C880,702.1624 880,535.9749 895,535.9749 L905,535.9749 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="683" x="905" y="574.1233"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="663" x="915" y="597.1184">~104 MB is reserved at the top of the kernel's memory space for non-contiguous allocations</text><path d="M855,702.1624 L865,702.1624 C880,702.1624 880,592.2717 895,592.2717 L905,592.2717 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="121" x="905" y="674.8655"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="101" x="915" y="697.8606">Low Memory</text><rect fill="#F1F1F1" height="52.5938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="502" x="1076" y="630.4202"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="1086" y="653.4153">Only the</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="101" x="1151" y="653.4153">bottom part</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="312" x="1256" y="653.4153">of physical RAM has a kernel logical address</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="249" x="1086" y="669.7122">(896MB, 0xc0000000 ~ 0xf800000)</text><path d="M1026,693.0139 L1036,693.0139 C1051,693.0139 1051,656.717 1066,656.717 L1076,656.717 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="52.5938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="266" x="1076" y="703.0139"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="246" x="1086" y="726.009">this memory is called Low Memory</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="236" x="1086" y="742.3059">phys: 0x00000000 ~ 0xf8000000</text><path d="M1026,693.0139 L1036,693.0139 C1051,693.0139 1051,729.3108 1066,729.3108 L1076,729.3108 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M855,702.1624 L865,702.1624 C880,702.1624 880,693.0139 895,693.0139 L905,693.0139 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="125" x="905" y="831.9045"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="105" x="915" y="854.8997">High Memory</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="137" x="1080" y="775.6077"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1090" y="798.6028">beyond ~896MB</text><path d="M1030,850.053 L1040,850.053 C1055,850.053 1055,793.7561 1070,793.7561 L1080,793.7561 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="148" x="1080" y="831.9045"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="1090" y="854.8997">No logical address</text><path d="M1030,850.053 L1040,850.053 C1055,850.053 1055,850.053 1070,850.053 L1080,850.053 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="377" x="1080" y="888.2014"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="357" x="1090" y="911.1965">Not physically contiguous when used in the kernel</text><path d="M1030,850.053 L1040,850.053 C1055,850.053 1055,906.3499 1070,906.3499 L1080,906.3499 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M855,702.1624 L865,702.1624 C880,702.1624 880,850.053 895,850.053 L905,850.053 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="513" x="908" y="948.4934">-&gt; 这种情况只会在32bit中出现，kernel virtual memory &lt; physical memory</text><path d="M855,702.1624 L865,702.1624 C880,702.1624 880,943.6467 895,943.6467 L905,943.6467 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M436,674.0139 L446,674.0139 C461,674.0139 461,702.1624 476,702.1624 L486,702.1624 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M324,730.3108 L334,730.3108 C349,730.3108 349,674.0139 364,674.0139 L374,674.0139 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="62" x="374" y="962.7952"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="384" y="985.7903">64 bit</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="490" x="486" y="962.7952"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="470" x="496" y="985.7903">always enough kernel address space to accommodate all the RAM</text><path d="M436,980.9436 L446,980.9436 C461,980.9436 461,980.9436 476,980.9436 L486,980.9436 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M324,730.3108 L334,730.3108 C349,730.3108 349,980.9436 364,980.9436 L374,980.9436 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="1090" x="374" y="1019.092"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="700" x="384" y="1042.0872">just beacause physical addresses could have a kernel logical address, it doesn't mean the kernel is</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="259" x="1088" y="1042.0872">actually using every byte of memory</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="1351" y="1042.0872">on the system</text><path d="M324,730.3108 L334,730.3108 C349,730.3108 349,1037.2405 364,1037.2405 L374,1037.2405 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M192,537.6945 L202,537.6945 C217,537.6945 217,730.3108 232,730.3108 L242,730.3108 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[dc3a854ae6dd3c4faefc8f2b91d25e9a]
@startmindmap
+[#orange] Kernel Logical Address
++ Normal address space of kernel
***[#moccasin]:<code>
kmalloc()
</code>;
+++ Kernel stacks (per process)
++ A **fixed offset** from their physical addresses
+++_ Virt: 0xc0000000 - -> Phys: 0x00000000
+++ virtually-contiguous regions are by nature also physically contiguous
+++ combined with the inablity to be swapped out, makes them suitable for **DMA** transfers
++ easy to convert between virtual and physical
***[#moccasin]:<code>
__pa(x)
</code>;
***[#moccasin]:<code>
__va(x)
</code>;
++ Can never be swapped out
++ Mapping
+++ 32 bit
++++ for small-memory systems (below 1GB RAM)
+++++ Kernel Logical address space starts at **PAGE_OFFSET** and goes through the **end of physical memory**
++++ for large-memory systems (more than 1GB RAM)
+++++ not all of the physical RAM can be mapped into kernel's address space
+++++ kernel address space is the top 1GB of virtual address space, by default
+++++ ~104 MB is reserved at the top of the kernel's memory space for non-contiguous allocations
+++++ **Low Memory**
******:Only the **bottom part** of physical RAM has a kernel logical address
(896MB, 0xc0000000 ~ 0xf800000);
******:this memory is called Low Memory
phys: 0x00000000 ~ 0xf8000000;
+++++ **High Memory**
++++++ beyond ~896MB
++++++ No logical address
++++++ Not physically contiguous when used in the kernel
+++++_ -> 这种情况只会在32bit中出现，kernel virtual memory < physical memory
+++ 64 bit
++++ always enough kernel address space to accommodate all the RAM
+++ just beacause physical addresses could have a kernel logical address, it doesn't mean the kernel is <i>actually using every byte of memory</i> on the system
@endmindmap

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>