<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="753px" preserveAspectRatio="none" style="width:1889px;height:753px;background:#FFFFFF;" version="1.1" viewBox="0 0 1889 753" width="1889px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="104" x="10" y="357.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="20" y="380.7764">Page tables</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="530" x="164" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="510" x="174" y="42.9951">Far more mappings can be made than can exist in the TLB at one time.</text><path d="M114,375.9297 L124,375.9297 C139,375.9297 139,38.1484 154,38.1484 L164,38.1484 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="626" x="164" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="507" x="174" y="99.292">The kernel keep the track of all of the mappings all of the time, in the</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="95" x="685" y="99.292">page tabels</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="213" x="840" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="850" y="99.292">struct mm, vm_area_struct</text><path d="M790,94.4453 L800,94.4453 C815,94.4453 815,94.4453 830,94.4453 L840,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,375.9297 L124,375.9297 C139,375.9297 139,94.4453 154,94.4453 L164,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="358" x="164" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="338" x="174" y="268.1826">kernel holds the mappings have no TLB entries</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="621" x="572" y="132.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="601" x="582" y="155.5889">Find the appropriate mapping for the offending address in the kernel's page tables</text><path d="M522,263.3359 L532,263.3359 C547,263.3359 547,150.7422 562,150.7422 L572,150.7422 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="311" x="572" y="188.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="291" x="582" y="211.8857">Select and remove an existing TLB entry</text><path d="M522,263.3359 L532,263.3359 C547,263.3359 547,207.0391 562,207.0391 L572,207.0391 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="417" x="572" y="245.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="397" x="582" y="268.1826">Create a TLB entry for the page containing the address</text><path d="M522,263.3359 L532,263.3359 C547,263.3359 547,263.3359 562,263.3359 L572,263.3359 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="258" x="572" y="301.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="582" y="324.4795">Return to the user space process</text><path d="M522,263.3359 L532,263.3359 C547,263.3359 547,319.6328 562,319.6328 L572,319.6328 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="301" x="572" y="357.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="281" x="582" y="380.7764">(Similarities to lazy allocation handling)</text><path d="M522,263.3359 L532,263.3359 C547,263.3359 547,375.9297 562,375.9297 L572,375.9297 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,375.9297 L124,375.9297 C139,375.9297 139,263.3359 154,263.3359 L164,263.3359 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="90" x="164" y="554.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="174" y="577.8154">Swapping</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="670" x="304" y="414.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="650" x="314" y="437.0732">When memory utilization is high, the kernel may swap some frames to disk to free up RAM</text><path d="M254,572.9688 L264,572.9688 C279,572.9688 279,432.2266 294,432.2266 L304,432.2266 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="631" x="304" y="470.375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="314" y="493.3701">The kernel can copy a</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="48" x="475" y="493.3701">frame</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="402" x="523" y="493.3701">(which means physical) to disk and remove its TLB entry</text><path d="M254,572.9688 L264,572.9688 C279,572.9688 279,488.5234 294,488.5234 L304,488.5234 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="347" x="304" y="526.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="327" x="314" y="549.667">The frame can be re-used by another process</text><path d="M254,572.9688 L264,572.9688 C279,572.9688 279,544.8203 294,544.8203 L304,544.8203 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="1081" x="304" y="582.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="1061" x="314" y="605.9639">When the frame is needed again, the CPU will generate a page fault (because the address is not in the TLB). The kernel can then, at page fault time:</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="196" x="1435" y="498.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="1445" y="521.5186">Put the process to sleep</text><path d="M1385,601.1172 L1395,601.1172 C1410,601.1172 1410,516.6719 1425,516.6719 L1435,516.6719 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="442" x="1435" y="554.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="422" x="1445" y="577.8154">Copy the frame from the disk into an unused frame in RAM</text><path d="M1385,601.1172 L1395,601.1172 C1410,601.1172 1410,572.9688 1425,572.9688 L1435,572.9688 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="194" x="1435" y="611.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="174" x="1445" y="634.1123">Fix the page table entry</text><path d="M1385,601.1172 L1395,601.1172 C1410,601.1172 1410,629.2656 1425,629.2656 L1435,629.2656 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="149" x="1435" y="667.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1445" y="690.4092">Wake the process</text><path d="M1385,601.1172 L1395,601.1172 C1410,601.1172 1410,685.5625 1425,685.5625 L1435,685.5625 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M254,572.9688 L264,572.9688 C279,572.9688 279,601.1172 294,601.1172 L304,601.1172 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="766" x="304" y="639.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="746" x="314" y="662.2607">The restored page is not necessarily restored to the same physical frame where it originally was located</text><path d="M254,572.9688 L264,572.9688 C279,572.9688 279,657.4141 294,657.4141 L304,657.4141 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="778" x="304" y="695.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="758" x="314" y="718.5576">The MMU will use the same virtual address though, so the user space program will not know the difference</text><path d="M254,572.9688 L264,572.9688 C279,572.9688 279,713.7109 294,713.7109 L304,713.7109 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,375.9297 L124,375.9297 C139,375.9297 139,572.9688 154,572.9688 L164,572.9688 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[576689f39f55ae97035edd536fecd952]
@startmindmap
+ Page tables
++ Far more mappings can be made than can exist in the TLB at one time.
++ The kernel keep the track of all of the mappings all of the time, in the **page tabels**
+++ struct mm, vm_area_struct
++ kernel holds the mappings have no TLB entries
+++ Find the appropriate mapping for the offending address in the kernel's page tables
+++ Select and remove an existing TLB entry
+++ Create a TLB entry for the page containing the address
+++ Return to the user space process
+++ (Similarities to lazy allocation handling)
++ Swapping
+++ When memory utilization is high, the kernel may swap some frames to disk to free up RAM
+++ The kernel can copy a **frame**(which means physical) to disk and remove its TLB entry
+++ The frame can be re-used by another process
+++ When the frame is needed again, the CPU will generate a page fault (because the address is not in the TLB). The kernel can then, at page fault time:
++++ Put the process to sleep
++++ Copy the frame from the disk into an unused frame in RAM
++++ Fix the page table entry
++++ Wake the process
+++ The restored page is not necessarily restored to the same physical frame where it originally was located
+++ The MMU will use the same virtual address though, so the user space program will not know the difference
@endmindmap

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>