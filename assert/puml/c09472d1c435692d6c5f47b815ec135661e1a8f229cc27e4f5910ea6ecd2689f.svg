<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="778px" preserveAspectRatio="none" style="width:1889px;height:778px;background:#FFFFFF;" version="1.1" viewBox="0 0 1889 778" width="1889px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="104" x="10" y="370.0039"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="20" y="392.999">Page tables</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="530" x="164" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="510" x="174" y="42.9951">Far more mappings can be made than can exist in the TLB at one time.</text><path d="M114,388.1523 L124,388.1523 C139,388.1523 139,38.1484 154,38.1484 L164,38.1484 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="626" x="164" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="507" x="174" y="99.292">The kernel keep the track of all of the mappings all of the time, in the</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="95" x="685" y="99.292">page tabels</text><rect fill="#F1F1F1" height="85.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="177" x="840" y="51.8516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="850" y="74.8467">[#moccasin]&lt;code&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="850" y="91.1436">struct mm</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="850" y="107.4404">struct vm_area_struct</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="850" y="123.7373">&lt;/code&gt;</text><path d="M790,94.4453 L800,94.4453 C815,94.4453 815,94.4453 830,94.4453 L840,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,388.1523 L124,388.1523 C139,388.1523 139,94.4453 154,94.4453 L164,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="358" x="164" y="269.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="338" x="174" y="292.6279">kernel holds the mappings have no TLB entries</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="621" x="572" y="157.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="601" x="582" y="180.0342">Find the appropriate mapping for the offending address in the kernel's page tables</text><path d="M522,287.7813 L532,287.7813 C547,287.7813 547,175.1875 562,175.1875 L572,175.1875 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="311" x="572" y="213.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="291" x="582" y="236.3311">Select and remove an existing TLB entry</text><path d="M522,287.7813 L532,287.7813 C547,287.7813 547,231.4844 562,231.4844 L572,231.4844 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="417" x="572" y="269.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="397" x="582" y="292.6279">Create a TLB entry for the page containing the address</text><path d="M522,287.7813 L532,287.7813 C547,287.7813 547,287.7813 562,287.7813 L572,287.7813 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="258" x="572" y="325.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="582" y="348.9248">Return to the user space process</text><path d="M522,287.7813 L532,287.7813 C547,287.7813 547,344.0781 562,344.0781 L572,344.0781 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="301" x="572" y="382.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="281" x="582" y="405.2217">(Similarities to lazy allocation handling)</text><path d="M522,287.7813 L532,287.7813 C547,287.7813 547,400.375 562,400.375 L572,400.375 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,388.1523 L124,388.1523 C139,388.1523 139,287.7813 154,287.7813 L164,287.7813 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="90" x="164" y="579.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="174" y="602.2607">Swapping</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="670" x="304" y="438.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="650" x="314" y="461.5186">When memory utilization is high, the kernel may swap some frames to disk to free up RAM</text><path d="M254,597.4141 L264,597.4141 C279,597.4141 279,456.6719 294,456.6719 L304,456.6719 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="631" x="304" y="494.8203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="314" y="517.8154">The kernel can copy a</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="48" x="475" y="517.8154">frame</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="402" x="523" y="517.8154">(which means physical) to disk and remove its TLB entry</text><path d="M254,597.4141 L264,597.4141 C279,597.4141 279,512.9688 294,512.9688 L304,512.9688 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="347" x="304" y="551.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="327" x="314" y="574.1123">The frame can be re-used by another process</text><path d="M254,597.4141 L264,597.4141 C279,597.4141 279,569.2656 294,569.2656 L304,569.2656 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="1081" x="304" y="607.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="1061" x="314" y="630.4092">When the frame is needed again, the CPU will generate a page fault (because the address is not in the TLB). The kernel can then, at page fault time:</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="196" x="1435" y="522.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="1445" y="545.9639">Put the process to sleep</text><path d="M1385,625.5625 L1395,625.5625 C1410,625.5625 1410,541.1172 1425,541.1172 L1435,541.1172 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="442" x="1435" y="579.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="422" x="1445" y="602.2607">Copy the frame from the disk into an unused frame in RAM</text><path d="M1385,625.5625 L1395,625.5625 C1410,625.5625 1410,597.4141 1425,597.4141 L1435,597.4141 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="194" x="1435" y="635.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="174" x="1445" y="658.5576">Fix the page table entry</text><path d="M1385,625.5625 L1395,625.5625 C1410,625.5625 1410,653.7109 1425,653.7109 L1435,653.7109 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="149" x="1435" y="691.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1445" y="714.8545">Wake the process</text><path d="M1385,625.5625 L1395,625.5625 C1410,625.5625 1410,710.0078 1425,710.0078 L1435,710.0078 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M254,597.4141 L264,597.4141 C279,597.4141 279,625.5625 294,625.5625 L304,625.5625 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="766" x="304" y="663.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="746" x="314" y="686.7061">The restored page is not necessarily restored to the same physical frame where it originally was located</text><path d="M254,597.4141 L264,597.4141 C279,597.4141 279,681.8594 294,681.8594 L304,681.8594 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="778" x="304" y="720.0078"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="758" x="314" y="743.0029">The MMU will use the same virtual address though, so the user space program will not know the difference</text><path d="M254,597.4141 L264,597.4141 C279,597.4141 279,738.1563 294,738.1563 L304,738.1563 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,388.1523 L124,388.1523 C139,388.1523 139,597.4141 154,597.4141 L164,597.4141 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[d64b41e31ad28da5d2c3d0c97a4b386c]
@startmindmap
+ Page tables
++ Far more mappings can be made than can exist in the TLB at one time.
++ The kernel keep the track of all of the mappings all of the time, in the **page tabels**
***:[#moccasin]<code>
struct mm
struct vm_area_struct
</code>;
++ kernel holds the mappings have no TLB entries
+++ Find the appropriate mapping for the offending address in the kernel's page tables
+++ Select and remove an existing TLB entry
+++ Create a TLB entry for the page containing the address
+++ Return to the user space process
+++ (Similarities to lazy allocation handling)
++ Swapping
+++ When memory utilization is high, the kernel may swap some frames to disk to free up RAM
+++ The kernel can copy a **frame**(which means physical) to disk and remove its TLB entry
+++ The frame can be re-used by another process
+++ When the frame is needed again, the CPU will generate a page fault (because the address is not in the TLB). The kernel can then, at page fault time:
++++ Put the process to sleep
++++ Copy the frame from the disk into an unused frame in RAM
++++ Fix the page table entry
++++ Wake the process
+++ The restored page is not necessarily restored to the same physical frame where it originally was located
+++ The MMU will use the same virtual address though, so the user space program will not know the difference
@endmindmap

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>