<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="762px" preserveAspectRatio="none" style="width:1889px;height:762px;background:#FFFFFF;" version="1.1" viewBox="0 0 1889 762" width="1889px" zoomAndPan="magnify"><defs/><g><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="104" x="10" y="362.107"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="20" y="385.1021">Page tables</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="530" x="164" y="20"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="510" x="174" y="42.9951">Far more mappings can be made than can exist in the TLB at one time.</text><path d="M114,380.2554 L124,380.2554 C139,380.2554 139,38.1484 154,38.1484 L164,38.1484 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="626" x="164" y="76.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="507" x="174" y="99.292">The kernel keep the track of all of the mappings all of the time, in the</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="95" x="685" y="99.292">page tabels</text><rect fill="#FFE4B5" height="53.5999" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="188" x="840" y="67.6454"/><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="72" x="850" y="90.6093">struct mm</text><text fill="#000000" font-family="monospace" font-size="14" lengthAdjust="spacing" textLength="168" x="850" y="107.4093">struct vm_area_struct</text><path d="M790,94.4453 L800,94.4453 C815,94.4453 815,94.4453 830,94.4453 L840,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,380.2554 L124,380.2554 C139,380.2554 139,94.4453 154,94.4453 L164,94.4453 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="358" x="164" y="253.839"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="338" x="174" y="276.8341">kernel holds the mappings have no TLB entries</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="621" x="572" y="141.2452"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="601" x="582" y="164.2404">Find the appropriate mapping for the offending address in the kernel's page tables</text><path d="M522,271.9874 L532,271.9874 C547,271.9874 547,159.3937 562,159.3937 L572,159.3937 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="311" x="572" y="197.5421"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="291" x="582" y="220.5372">Select and remove an existing TLB entry</text><path d="M522,271.9874 L532,271.9874 C547,271.9874 547,215.6906 562,215.6906 L572,215.6906 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="417" x="572" y="253.839"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="397" x="582" y="276.8341">Create a TLB entry for the page containing the address</text><path d="M522,271.9874 L532,271.9874 C547,271.9874 547,271.9874 562,271.9874 L572,271.9874 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="258" x="572" y="310.1359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="582" y="333.131">Return to the user space process</text><path d="M522,271.9874 L532,271.9874 C547,271.9874 547,328.2843 562,328.2843 L572,328.2843 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="301" x="572" y="366.4327"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="281" x="582" y="389.4279">(Similarities to lazy allocation handling)</text><path d="M522,271.9874 L532,271.9874 C547,271.9874 547,384.5812 562,384.5812 L572,384.5812 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,380.2554 L124,380.2554 C139,380.2554 139,271.9874 154,271.9874 L164,271.9874 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="90" x="164" y="563.4718"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="174" y="586.4669">Swapping</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="670" x="304" y="422.7296"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="650" x="314" y="445.7247">When memory utilization is high, the kernel may swap some frames to disk to free up RAM</text><path d="M254,581.6202 L264,581.6202 C279,581.6202 279,440.8781 294,440.8781 L304,440.8781 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="631" x="304" y="479.0265"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="314" y="502.0216">The kernel can copy a</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="48" x="475" y="502.0216">frame</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="402" x="523" y="502.0216">(which means physical) to disk and remove its TLB entry</text><path d="M254,581.6202 L264,581.6202 C279,581.6202 279,497.1749 294,497.1749 L304,497.1749 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="347" x="304" y="535.3234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="327" x="314" y="558.3185">The frame can be re-used by another process</text><path d="M254,581.6202 L264,581.6202 C279,581.6202 279,553.4718 294,553.4718 L304,553.4718 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="1081" x="304" y="591.6202"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="1061" x="314" y="614.6154">When the frame is needed again, the CPU will generate a page fault (because the address is not in the TLB). The kernel can then, at page fault time:</text><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="196" x="1435" y="507.1749"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="176" x="1445" y="530.17">Put the process to sleep</text><path d="M1385,609.7687 L1395,609.7687 C1410,609.7687 1410,525.3234 1425,525.3234 L1435,525.3234 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="442" x="1435" y="563.4718"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="422" x="1445" y="586.4669">Copy the frame from the disk into an unused frame in RAM</text><path d="M1385,609.7687 L1395,609.7687 C1410,609.7687 1410,581.6202 1425,581.6202 L1435,581.6202 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="194" x="1435" y="619.7687"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="174" x="1445" y="642.7638">Fix the page table entry</text><path d="M1385,609.7687 L1395,609.7687 C1410,609.7687 1410,637.9171 1425,637.9171 L1435,637.9171 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="149" x="1435" y="676.0656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1445" y="699.0607">Wake the process</text><path d="M1385,609.7687 L1395,609.7687 C1410,609.7687 1410,694.214 1425,694.214 L1435,694.214 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M254,581.6202 L264,581.6202 C279,581.6202 279,609.7687 294,609.7687 L304,609.7687 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="766" x="304" y="647.9171"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="746" x="314" y="670.9122">The restored page is not necessarily restored to the same physical frame where it originally was located</text><path d="M254,581.6202 L264,581.6202 C279,581.6202 279,666.0656 294,666.0656 L304,666.0656 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><rect fill="#F1F1F1" height="36.2969" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:1.5;" width="778" x="304" y="704.214"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="758" x="314" y="727.2091">The MMU will use the same virtual address though, so the user space program will not know the difference</text><path d="M254,581.6202 L264,581.6202 C279,581.6202 279,722.3624 294,722.3624 L304,722.3624 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M114,380.2554 L124,380.2554 C139,380.2554 139,581.6202 154,581.6202 L164,581.6202 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[cef3cb3869268099062c96e9d589e008]
@startmindmap
+ Page tables
++ Far more mappings can be made than can exist in the TLB at one time.
++ The kernel keep the track of all of the mappings all of the time, in the **page tabels**
***[#moccasin]:<code>
struct mm
struct vm_area_struct
</code>;
++ kernel holds the mappings have no TLB entries
+++ Find the appropriate mapping for the offending address in the kernel's page tables
+++ Select and remove an existing TLB entry
+++ Create a TLB entry for the page containing the address
+++ Return to the user space process
+++ (Similarities to lazy allocation handling)
++ Swapping
+++ When memory utilization is high, the kernel may swap some frames to disk to free up RAM
+++ The kernel can copy a **frame**(which means physical) to disk and remove its TLB entry
+++ The frame can be re-used by another process
+++ When the frame is needed again, the CPU will generate a page fault (because the address is not in the TLB). The kernel can then, at page fault time:
++++ Put the process to sleep
++++ Copy the frame from the disk into an unused frame in RAM
++++ Fix the page table entry
++++ Wake the process
+++ The restored page is not necessarily restored to the same physical frame where it originally was located
+++ The MMU will use the same virtual address though, so the user space program will not know the difference
@endmindmap

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>